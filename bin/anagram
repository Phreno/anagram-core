#!/usr/bin/env node
// Generated by CoffeeScript 1.10.0
(function() {
  var displayAnagrammes, filter, program, source;

  require('../index.js');

  program = require('commander');

  program.option('-t, --text <text>', 'texte source').option('-l, --list', 'cache les détaille').option('-f, --filter <filter>', 'filtre a appliquer lors de la recherche de résultat').parse(process.argv);

  displayAnagrammes = function(candidate) {
    var output, substraction;
    output = "";
    if (!program.list) {
      output += (program.text.anagramSanitization().sortByFrequency().reverse()) + " ; ";
    }
    output += "" + candidate;
    if (!program.list) {
      substraction = source.substractWord(candidate).rawConcatenation().sortByFrequency().reverse();
      output += " ; " + substraction;
      if (program.filter) {
        output += " ; «" + program.filter + "»";
      }
    }
    return console.log(output);
  };

  if (program.text == null) {
    console.error('Un texte de travail est obligatoire (-t)');
    process.exit(1);
  }

  if (program.filter) {
    filter = {
      substraction: program.text.substractWord(program.filter),
      outOfPerimeter: []
    };
    Object.keys(filter.substraction).forEach(function(key) {
      if (filter.substraction[key] < 0) {
        return filter.outOfPerimeter.push(key + ": " + filter.substraction[key]);
      }
    });
  }

  source = (program.filter ? filter.substraction.rawConcatenation() : program.text);

  source.elligiblesForAnagram().sort(function(a, b) {
    return a.length - b.length;
  }).forEach(displayAnagrammes);

  if (program.filter) {
    filter.outOfPerimeter.forEach(function(r) {
      return console.log(r);
    });
  }

}).call(this);
